# Automatically generated by Updater v1.0
# @author Daniel J. Finnegan

cmake_minimum_required (VERSION 3.8.0)
cmake_policy (SET CMP0048 NEW)

project (
	Unity-Updater-Project
	VERSION
		1.0
	LANGUAGES
		NONE
)

# Change this to whatever you want to call your built application
# It will also set the name of the product installer built with NSIS
set (
	AUTO_APP_NAME
		Unity-Application
)

option (
	BUILD_INSTALLER
		"Build the project installer (requires NSIS in the PATH variable)"
)

if (BUILD_INSTALLER)

set (
	INSTALLER_NAME
		My-Program-Installer
)

set (
	COMPANY_NAME
		Lancophone
)

# Note that the version number and product name are passed to the NSIS script
add_custom_target (
	${INSTALLER_NAME}
	ALL
	DEPENDS
		${AUTO_APP_NAME}
	COMMAND
		"C:/Program Files (x86)/NSIS/makensis.exe"
		"/XOutFile ${CMAKE_SOURCE_DIR}/build/${AUTO_APP_NAME}_v${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}-Installer.exe"
		"/X!define PRODUCT_NAME ${AUTO_APP_NAME}"
		"/X!define COMPANY_NAME ${COMPANY_NAME}"
		"/X!define UNINSTALLER_NAME ${AUTO_APP_NAME}-Uninstaller"
		"/X!define PRODUCT_ROOT_DIR ${CMAKE_SOURCE_DIR}"
		${CMAKE_SOURCE_DIR}/scripts/installer.nsi
	COMMENT
		"Building ${INSTALLER_NAME}..."
)

endif()

#
# The Unity Updater template is only supported on OSX and Windows
#

list (
	APPEND
	CMAKE_MODULE_PATH
	"${CMAKE_SOURCE_DIR}/cmake"
)

find_package ( 
	UnityGame
	2018.1
	EXACT
	REQUIRED
)

if (APPLE) # We only support OSX or Windows, both 64 bit

add_custom_target (
	${AUTO_APP_NAME}
	ALL
	COMMAND
		/Applications/Unity/Unity.app/Contents/MacOS/Unity
		-quit
		-batchmode
		-logFile ${CMAKE_BINARY_DIR}/logs/Editor.log
		-projectPath ${CMAKE_SOURCE_DIR}/unity/
	COMMENT
		"Building ${AUTO_APP_NAME}..."
)

elseif (WIN32) # We only support OSX or Windows, both 64 bit

add_custom_target (
	${AUTO_APP_NAME}
	ALL
	COMMAND
		"C:/Program Files/Unity/Editor/Unity.exe"
		-quit
		-batchmode
		-projectPath ${CMAKE_SOURCE_DIR}/unity
		-buildWindows64Player
		${CMAKE_SOURCE_DIR}/build/${AUTO_APP_NAME}.exe
	COMMENT
		"Building ${AUTO_APP_NAME}..."		
)

else () # Just echo a statement on any other system

add_custom_target (
	${AUTO_APP_NAME}
	ALL
	COMMAND
		echo "Only supported on OSX and Windows, soz!"
)

endif()
